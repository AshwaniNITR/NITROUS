"use strict";(()=>{var e={};e.id=6976,e.ids=[6976],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},74703:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>R,requestAsyncStorage:()=>h,routeModule:()=>v,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>E});var i={};t.r(i),t.d(i,{GET:()=>d}),t(95655);var s=t(83323),a=t(54647),n=t(66886),o=t(23269),u=t.n(o),c=t(15418),l=t(39381);async function d(e){try{await (0,l.Z)();let r=e.nextUrl.searchParams.get("token"),t=e.headers.get("accept")?.includes("application/json");if(!r){if(t)return n.Z.json({error:"Token is required"},{status:400});return n.Z.redirect(new URL("/auth/verification-failed?error=missing_token",e.url))}let i=u().verify(r,process.env.TOKEN_SECRET);if("VERIFY"!==i.emailType){if(t)return n.Z.json({error:"Invalid token type"},{status:400});return n.Z.redirect(new URL("/auth/verification-failed?error=invalid_token_type",e.url))}let s=await c.Z.findById(i.userId);if(!s){if(t)return n.Z.json({error:"User not found"},{status:404});return n.Z.redirect(new URL("/auth/verification-failed?error=user_not_found",e.url))}if(s.isVerified){let{accessToken:r,refreshToken:i}=await p(s);if(t)return n.Z.json({success:!0,message:"Email already verified",accessToken:r});return f("/home",r,i,e)}s.isVerified=!0;let{accessToken:a,refreshToken:o}=await p(s);if(await s.save(),t)return n.Z.json({success:!0,message:"Email verified successfully",accessToken:a});return f("/home",a,o,e)}catch(t){console.error("Verification error:",t);let r=t instanceof Error?t.message:"Verification failed";if(e.headers.get("accept")?.includes("application/json"))return n.Z.json({error:r},{status:400});return n.Z.redirect(new URL(`/auth/verification-failed?error=${encodeURIComponent(r)}`,e.url))}}async function p(e){let r=u().sign({userId:e._id.toString(),email:e.email},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"15m"}),t=u().sign({userId:e._id.toString()},process.env.REFRESH_TOKEN_SECRET,{expiresIn:"7d"});return e.refreshToken=t,await e.save(),{accessToken:r,refreshToken:t}}function f(e,r,t,i){let s=n.Z.redirect(new URL(e,i.url));return s.cookies.set("accessToken",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:900,path:"/"}),s.cookies.set("refreshToken",t,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),s}let m=s.AppRouteRouteModule,v=new m({definition:{kind:a.x.APP_ROUTE,page:"/api/verify/route",pathname:"/api/verify",filename:"route",bundlePath:"app/api/verify/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\NITROUS\\app\\api\\verify\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:y,headerHooks:x,staticGenerationBailout:E}=v,R="/api/verify/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[4303,3269,9902],()=>t(74703));module.exports=i})();